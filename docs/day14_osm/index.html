<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Bougie Map</title>
<link href="https://unpkg.com/maplibre-gl@3.6.1/dist/maplibre-gl.css" rel="stylesheet"/>
<script src="https://unpkg.com/maplibre-gl@3.6.1/dist/maplibre-gl.js"></script>
<style>
body { margin:0; padding:0; }
#map { position:absolute; top:0; bottom:0; width:100%; }

.my-tooltip {
    font-size: 18px;        /* bigger text */
    font-weight: bold;      /* optional */
    padding: 12px 16px;     /* bigger padding */
    border-radius: 10px;
    color: #003300;         /* dark green text to match map theme */
    max-width:700px;
    line-height: 1.4;
    font-family: sans-serif;
}

#menu { 
    position:absolute;
    top:20px;
    right:20px;
    background:white;
    padding:12px;
    z-index:999; 
    font-family:sans-serif;
    border-radius:12px;
    width:350px;
    box-shadow:0 0 12px rgba(0,0,0,0.25);
}

/* Labels */
#menu label { 
    font-weight:bold; 
    font-family: 'Helvetica', sans-serif;
    font-size: 22px;
}

/* Slider */
#hex-slider {
    width:100%;
    height:14px;
    border-radius:7px;
    -webkit-appearance:none;
    background: linear-gradient(to right, #1b3a1b, #40ae40, #00FF00);
    margin:16px 0;
}

/* Webkit thumb with emoji */
#hex-slider::-webkit-slider-thumb {
    -webkit-appearance:none;
    height:40px;
    width:40px;
    border-radius:50%;
    background:#ffffff;
    border:2px solid #003300;
    cursor:pointer;
    position:relative;
    font-size:22px;
    text-align:center;
    line-height:36px;
}

/* Add emoji inside thumb (WebKit only) */
#hex-slider::-webkit-slider-thumb::after {
    content: "üåø";
    position:absolute;
    top:50%;
    left:50%;
    transform:translate(-50%,-50%);
}

/* Firefox thumb */
#hex-slider::-moz-range-thumb {
    height:40px;
    width:40px;
    border-radius:50%;
    background:#ffffff;
    border:2px solid #003300;
    cursor:pointer;
    font-size:22px;
    text-align:center;
    line-height:36px;
}

/* Scale labels */
#slider-labels {
    display:flex;
    justify-content:space-between;
    font-size:16px;
    font-weight:bold;
    color:#000;
}

#title-overlay {
    position: absolute;
    top: 20px;
    left: 20px;
    background: rgba(255,255,255,0.92);
    padding: 14px 18px;
    border-radius: 8px;
    box-shadow: 0 0 8px rgba(0,0,0,0.25);
    font-family: Arial, sans-serif;
    z-index: 9999;
    max-width: 700px;
}
#title-overlay h1 { margin:0; font-size:30px; }
#title-overlay h3 { margin:6px 0 4px 0; font-size:20px; font-weight:normal; }
#title-overlay h4 { margin:6px 0 4px 0; font-size:14px; font-weight:normal; }
a { color: #0b9b2f; }

</style>
</head>
<body>

<div id="map"></div>

<div id="menu">
  <label>Bougie Index</label>
  <input type="range" id="hex-slider" min="0" max="5" value="0" step="0.1"/>
  <div id="slider-labels">
      <span>Anywhere</span>
      <span>Only Hotspots</span>
  </div>
</div>

<div id="title-overlay">
    <h1>üçµ Tea Ceremony to Trendy Latte üßò</h1>
    <h3>Ancient traditions meet modern consumerism: </h3>
    <h3>Mapping matcha cafes and boutique wellness in NYC</h3>
    <h4 style="font-size:16px;">By <a href="https://github.com/jaanekaraster/30-day-map-challenge-25">@jaanekaraster</a> for the 30 Day Map Challenge</h4>
    <h4 style="font-size:14px;">Source: OpenStreetMap data</h4>
</div>

<script>
const map = new maplibregl.Map({
    container: "map",
    style: "https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json",
    center: [-73.95, 40.7128],
    zoom: 12
});

map.on("load", () => {

    map.addSource("bougie_hex", { type:"geojson", data:"hex_bougie.geojson" });

    map.addLayer({
        id:"bougie-hex-fill",
        type:"fill",
        source:"bougie_hex",
        paint:{
            "fill-color":["interpolate", ["linear"], ["get", "bougie_score"],
                0,"#1b3a1b",
                1,"#276227",
                2,"#338833",
                3,"#40ae40",
                4,"#4cd64c",
                5,"#37FF00FF"
            ],
            "fill-opacity":0.55
        }
    });

    map.addLayer({
        id:"bougie-hex-outline",
        type:"line",
        source:"bougie_hex",
        paint:{
            "line-color":"#003300",
            "line-width":0.5
        }
    });

    // -----------------------------
    // Slider filter
    // -----------------------------
    const slider = document.getElementById("hex-slider");
    slider.addEventListener("input", ()=>{
        const val = parseFloat(slider.value);
        map.setFilter("bougie-hex-fill", [">=", ["get","bougie_score"], val]);
        map.setFilter("bougie-hex-outline", [">=", ["get","bougie_score"], val]);
    });
});

const popup = new maplibregl.Popup({
    closeButton: false,
    closeOnClick: false,
    className: 'my-tooltip'
});

map.on('mousemove', 'bougie-hex-fill', (e) => {
    if (e.features.length > 0) {
        const feature = e.features[0];
        const matchaCount = feature.properties.matcha_count || 0;
        const wellnessCount = feature.properties.wellness_count || 0;

        popup
            .setLngLat(e.lngLat)
            .setHTML(
               `
               <strong>Businesses</strong><br/>
                üçµ Matcha: ${matchaCount}<br/>
                üßò Wellness: ${wellnessCount}`
            )
            .addTo(map);
    }
});

map.on('mouseleave', 'bougie-hex-fill', () => {
    popup.remove();
});

</script>

</body>
</html>
